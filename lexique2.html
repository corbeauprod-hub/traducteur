<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Traducteur Elfique</title>
<style>
  body{
    background: url('https://images.unsplash.com/photo-1526403220645-88a6b7e49dff?auto=format&fit=crop&w=1300&q=80') center/cover fixed;
    color:white;
    font-family: "Cinzel", serif;
    padding:20px;
    text-shadow: 0 0 5px black;
  }
  .container{
    background:rgba(0,0,0,0.6);
    padding:20px;
    border-radius:10px;
    max-width:800px;
    margin:auto;
  }
  input,textarea{
    width:100%;padding:10px;margin:10px 0;
    background:#222;color:white;border:1px solid #555;
    border-radius:8px;
  }
  button{
    padding:10px 20px;
    border:0;border-radius:8px;
    background:#6b4e2e;color:white;
    font-weight:bold;cursor:pointer;
  }
  button:hover{background:#8b6a45;}
  #resultat,#lexiqueArea{
    white-space:pre-wrap;
    background:#111;padding:10px;
    border-radius:8px;margin-top:10px;
  }
  #searchResults div{
    padding:4px;
    border-bottom:1px solid #444;
  }
</style>
</head>
<body>

<div class="container">

<h2>Traducteur Elfique</h2>

<textarea id="texte" placeholder="Texte franÃ§ais Ã  traduire"></textarea>
<button onclick="traduire()">Traduire</button>

<h3>RÃ©sultat</h3>
<div id="resultat"></div>

<hr>

<h3>Recherche dans le lexique</h3>
<input type="text" id="searchBox" placeholder="Rechercher un mot..." oninput="rechercherMot()">
<div id="searchResults"></div>

<hr>

<h3>Lexique entier (triÃ©)</h3>
<pre id="lexiqueArea"></pre>

</div>

<script>
/* ===========================================
   1. Lexique de base (INCHANGÃ‰)
   =========================================== */
const lexiqueBase = {
  "nuit":"nar","jour":"ar","blanc":"ar","gris":"gil","argentÃ©":"gilar","noir":"niel","aube":"vanar","or":"gala",
  "brume":"gileth","tÃ©nÃ¨bres":"nielor","ombre":"lanar","crÃ©puscule":"gilnar",
  "noble": "syl","noblesse": "syldar","prince": "lanasyl","roi": "anasyl","champion": "danasyl",
  "dieu": "valar",
  "je":"mi","tu":"ti","il":"sa","elle":"sa","nous":"men","vous":"ven","ils":"serin","elles":"serin",
  "Ãªtre":"era","suis":"era","es":"era","est":"era","sommes":"era","Ãªtes":"era","sont":"era",
  "avoir":"vara","ai":"vara","as":"vara","a":"vara","avons":"vara","avez":"vara","ont":"vara",
  "aller":"lira","venir":"qira","faire":"orna","voir":"mirÃ«","dire":"telrÃ«","lever": "velei","tomber": "veniel",
  "espoir":"orea"
};

/* ===========================================
   2. Lexique persistant (INCHANGÃ‰)
   =========================================== */
let lexique = {...lexiqueBase, ...JSON.parse(localStorage.getItem("elfiqueLexique")||"{}")};
function sauvegarderLexique(){localStorage.setItem("elfiqueLexique", JSON.stringify(lexique));}

/* ===========================================
   3. Pluriel (INCHANGÃ‰)
   =========================================== */
function estPluriel(mot){return mot.endsWith("s")&&!mot.endsWith("us");}
function plurielElfique(mot){return mot.endsWith("in")?mot:mot+"in";}

/* ===========================================
   4. Tri alphabÃ©tique avec accentuation
   =========================================== */
const ordreVoyelles = {"a":0,"Ã ":1,"Ã¢":2,"e":3,"Ã©":4,"Ã¨":5,"Ãª":6,"Ã«":7,"i":8,"Ã®":9,"Ã¯":10,"o":11,"Ã´":12,"Ã¶":13,"u":14,"Ã¹":15,"Ã»":16,"Ã¼":17,"y":18,"Ã¿":19};

function comparerMots(a,b){
  let A = a.normalize("NFD");
  let B = b.normalize("NFD");
  for(let i=0;i<Math.min(A.length,B.length);i++){
    const ca = A[i], cb = B[i];
    if(ca===cb) continue;
    const va = ordreVoyelles[ca] ?? ca.charCodeAt(0);
    const vb = ordreVoyelles[cb] ?? cb.charCodeAt(0);
    return va - vb;
  }
  return A.length - B.length;
}

/* ===========================================
   5. GÃ©nÃ©ration harmonisÃ©e AVEC anti-doublons
   =========================================== */
function genererMotElfique(motFr, syllabesUtilisees, terminaisonsUtilisees){

  const racines=["ar","nar","gil","syl","niel","val","lu","el","lin"];
  const suffixes=["el","en","ion","or","ath","iel","ys","lin","ar","Ã«"];

  let mot, essais=0;

  do{
    const r = racines[Math.floor(Math.random()*racines.length)];
    const s = suffixes[Math.floor(Math.random()*suffixes.length)];
    mot = r+s;
    essais++;

    if(essais>50) break;

    /* ðŸ”¥ ANTI-DOUBLONS AJOUTÃ‰ ICI */
    const existeDeja = Object.values(lexique).includes(mot);
    if(existeDeja) continue;

  }while(
      syllabesUtilisees.has(mot.slice(0,2)) ||
      terminaisonsUtilisees.has(mot.slice(-2))
  );

  syllabesUtilisees.add(mot.slice(0,2));
  terminaisonsUtilisees.add(mot.slice(-2));

  lexique[motFr] = mot;
  sauvegarderLexique();
  return mot;
}

/* ===========================================
   6. Traduction (INCHANGÃ‰)
   =========================================== */
function traduire(){
  const txt=document.getElementById("texte").value.toLowerCase().split(/\s+/);
  let res=[];
  let syllabesUtil=new Set();
  let terminaisonsUtil=new Set();

  for(let mot of txt){
    if(mot.trim()==="") continue;

    let base=mot;
    let plur=estPluriel(base);

    if(lexique[base]){ res.push(plur ? plurielElfique(lexique[base]) : lexique[base]); continue; }

    let m=genererMotElfique(base,syllabesUtil,terminaisonsUtil);
    if(plur) m=plurielElfique(m);
    res.push(m);
  }

  document.getElementById("resultat").innerText=res.join(" ");
  afficherLexique();
}

/* ===========================================
   7. Moteur de recherche amÃ©liorÃ©
   =========================================== */
function rechercherMot(){
  const q = document.getElementById("searchBox").value.toLowerCase();
  const zone = document.getElementById("searchResults");

  if(q===""){ zone.innerHTML=""; return; }

  const rÃ©sultats = Object.entries(lexique)
      .filter(([fr,elf]) => fr.includes(q) || elf.includes(q))
      .sort((a,b)=> comparerMots(a[0],b[0]));

  zone.innerHTML = rÃ©sultats
      .map(([fr,elf]) => `<div><b>${fr}</b> : ${elf}</div>`)
      .join("");
}

/* ===========================================
   8. Affichage du lexique complet triÃ©
   =========================================== */
function afficherLexique(){
  const zone=document.getElementById("lexiqueArea");
  const clÃ©s = Object.keys(lexique).sort(comparerMots);

  let txt="";
  for(let fr of clÃ©s){
    txt+= `${fr} = ${lexique[fr]}\n`;
  }
  zone.textContent=txt;
}

afficherLexique();
</script>
</body>
</html>
