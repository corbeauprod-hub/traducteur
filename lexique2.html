<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Traducteur Elfique Immersif</title>
<style>
body {
  font-family: "Trebuchet MS", Verdana, sans-serif;
  background: linear-gradient(to bottom, #f0f9f4, #d0e8d5);
  color: #0b3d0b;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
h1 {
  font-family: "Papyrus", serif;
  font-size: 3em;
  margin-top: 40px;
  color: #0a2d0a;
  text-shadow: 1px 1px 3px #a0d0a0;
}
.container {
  background: rgba(255,255,255,0.85);
  border-radius: 15px;
  padding: 25px;
  margin: 20px;
  width: 90%;
  max-width: 700px;
  box-shadow: 0 0 20px rgba(0,0,0,0.2);
}
textarea {
  width: 100%;
  height: 100px;
  border-radius: 8px;
  border: 1px solid #88c088;
  padding: 10px;
  font-size: 1.1em;
  resize: vertical;
  background: #f7fff7;
}
button {
  margin-top: 10px;
  margin-right: 10px;
  padding: 10px 20px;
  font-size: 1.1em;
  background: linear-gradient(to bottom, #a0d0a0, #70a070);
  border: none;
  border-radius: 10px;
  color: #fff;
  cursor: pointer;
  box-shadow: 0 3px 6px rgba(0,0,0,0.2);
  transition: all 0.2s ease;
}
button:hover {
  background: linear-gradient(to bottom, #70a070, #50a050);
  transform: scale(1.05);
}
#resultat {
  margin-top: 20px;
  font-size: 1.4em;
  font-style: italic;
  color: #134613;
  background: #f0fff0;
  padding: 15px;
  border-radius: 10px;
  min-height: 50px;
  line-height: 1.5em;
  white-space: pre-wrap;
}
footer {
  margin-top: auto;
  padding: 10px;
  font-size: 0.9em;
  color: #084008;
  text-align: center;
}
@media (max-width: 500px) {
  h1 { font-size: 2em; }
  button { font-size: 1em; padding: 8px 15px; margin-top: 8px; margin-right: 5px;}
  #resultat { font-size: 1.1em; }
}
</style>
</head>
<body>

<h1>Traducteur Elfique</h1>

<div class="container">
  <textarea id="frInput" placeholder="√âcris une phrase en fran√ßais ici..."></textarea><br>
  <button id="translateBtn">Traduire</button>
  <button id="viewLexiconBtn">Voir le lexique</button>
  <button id="resetLexiconBtn">R√©initialiser le lexique</button>
  <button id="exportLexiconBtn">Exporter le lexique</button>
  <input type="file" id="importLexiconInput" accept=".csv" style="display:none;">
  <button id="importLexiconBtn">Importer un lexique</button>
  <div id="resultat"></div>
</div>

<footer>Lexique auto-apprenant & immersif</footer>

<script>
/* ================= TRADUCTEUR ELF + LEXIQUE + IMPORT/EXPORT + HARMONIE ================= */

/* 1. Lexique de base */
const lexiqueBase = {
  "nuit": "nar","jour": "ar","blanc": "ar","gris": "gil","argent√©": "gilar","noir": "niel",
  "brume": "gileth","t√©n√®bres": "nielor","cr√©puscule": "gilnar",
  "noble": "syl","noblesse": "sylar","prince": "sylor",
  "je": "mi","tu": "ti","il": "sa","elle": "sa","nous": "men","vous": "ven","ils": "serin","elles": "serin",
  "√™tre": "era","suis": "era","es": "era","est": "era","sommes": "era","√™tes": "era","sont": "era",
  "avoir": "vara","ai": "vara","as": "vara","a": "vara","avons": "vara","avez": "vara","ont": "vara",
  "aller": "lira","venir": "nira","faire": "orna","voir": "mira","dire": "tela",
  "donner":"hiar","savoir":"eldra","penser":"sira","aimer":"melor","vouloir":"thera",
  "homme":"aran","femme":"anne","enfant":"elen","ami":"mellon","maison":"miriel","porte":"calenor",
  "arbre":"calen","eau":"n√ªr","feu":"nari","terre":"taren","montagne":"oron","mer":"l√¥s",
  "ciel":"elenor",
  "cheval":"ruan","√©p√©e":"brandel","epee":"brandel","bouclier":"thalar","citadelle":"umbar","ville":"siar",
  "route":"rima","march√©":"valen","marche":"valen","chant":"tinel","musique":"liriel","lumi√®re":"loriel","lumiere":"loriel",
  "ombre":"moriel","bonjour":"l√≥miel","adieu":"nairal","merci":"galen","s'il":"aen","s'il-vous-pla√Æt":"aenril",
  "s'il-vous-plait":"aenril","s'il-vous":"aen","oui":"ea","non":"na","peut-√™tre":"sila",
  "maintenant":"anor","hier":"enor","demain":"oror","et":"ar","√†":"an","a":"an","de":"s√Ø","du":"s√Ø"

};

/* 2. Lexique persistant */
let lexique = {...lexiqueBase, ...JSON.parse(localStorage.getItem("elfiqueLexique")||"{}")};
function sauvegarderLexique() { localStorage.setItem("elfiqueLexique", JSON.stringify(lexique)); }

/* 3. Pluriel */
function estPluriel(mot){return mot.endsWith("s") && !mot.endsWith("us");}
function plurielElfique(mot){return mot.endsWith("in")?mot:mot+"in";}

/* 4. G√©n√©ration mot elfique harmonis√© */
function genererMotElfique(motFr, syllabesUtilisees, terminaisonsUtilisees){
  const racines=["ar","nar","gil","syl","niel","val","lu","el","lin"];
  const suffixes=["el","en","ion","or","ath","iel","ys","lin","ar","√´"];
  let mot;
  let essais = 0;
  do {
    const r = racines[Math.floor(Math.random()*racines.length)];
    const s = suffixes[Math.floor(Math.random()*suffixes.length)];
    mot = r+s;

    // Eviter r√©p√©tition syllabe initiale et finale
    const debut = mot.slice(0,2);
    const fin = mot.slice(-2);
    essais++;
    if(essais>20) break; // √©viter boucle infinie
        /* üî• ANTI-DOUBLONS AJOUT√â ICI */
    const existeDeja = Object.values(lexique).includes(mot);
   if(existeDeja) continue;
  } while(syllabesUtilisees.has(mot.slice(0,2)) || terminaisonsUtilisees.has(mot.slice(-2)));

  syllabesUtilisees.add(mot.slice(0,2));
  terminaisonsUtilisees.add(mot.slice(-2));
  lexique[motFr] = mot;
  sauvegarderLexique();
  return mot;



}

/* 5. Traduction phrase avec harmonisation */
function traduireElfique(phrase){
  const mots = phrase.toLowerCase().replace(/[.,!?;:]/g,"").split(/\s+/);
  const resultat = [];
  const syllabesUtilisees = new Set();
  const terminaisonsUtilisees = new Set();

  for(let mot of mots){
    let traduction;

    if(lexique[mot]){
      traduction = lexique[mot];
      // enregistrer d√©but et fin pour harmonisation
      syllabesUtilisees.add(traduction.slice(0,2));
      terminaisonsUtilisees.add(traduction.slice(-2));
    } else {
      traduction = genererMotElfique(mot, syllabesUtilisees, terminaisonsUtilisees);
    }

    if(estPluriel(mot)) traduction = plurielElfique(traduction);

    resultat.push(traduction);
  }

  return resultat.join(" ");
}

/* 6. Interface */
const input = document.getElementById("frInput");
const btn = document.getElementById("translateBtn");
const output = document.getElementById("resultat");
const viewLexiconBtn = document.getElementById("viewLexiconBtn");
const resetLexiconBtn = document.getElementById("resetLexiconBtn");
const exportLexiconBtn = document.getElementById("exportLexiconBtn");
const importLexiconBtn = document.getElementById("importLexiconBtn");
const importLexiconInput = document.getElementById("importLexiconInput");

btn.addEventListener("click", ()=>{
  const fr = input.value.trim();
  output.innerText = fr ? traduireElfique(fr) : "";
});

/* Voir lexique */
viewLexiconBtn.addEventListener("click", ()=>{
  let texte = "";
  Object.keys(lexique).sort().forEach(k => { texte += `${k} ‚Üí ${lexique[k]}\n`; });
  alert(texte || "Lexique vide !");
});

/* R√©initialiser lexique */
resetLexiconBtn.addEventListener("click", ()=>{
  if(confirm("Voulez-vous vraiment r√©initialiser le lexique (mots auto-g√©n√©r√©s supprim√©s) ?")){
    localStorage.removeItem("elfiqueLexique");
    lexique = {...lexiqueBase};
    alert("Lexique r√©initialis√© !");
  }
});

/* Export CSV */
exportLexiconBtn.addEventListener("click", () => {
  let csvContent = "data:text/csv;charset=utf-8,";
  csvContent += "Fran√ßais,Elfique\n";
  Object.keys(lexique).sort().forEach(motFr => {
      const motEl = lexique[motFr];
      csvContent += `${motFr},${motEl}\n`;
  });
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", "lexique_elfique.csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
});

/* Import CSV */
importLexiconBtn.addEventListener("click", () => importLexiconInput.click());

importLexiconInput.addEventListener("change", (event)=>{
  const file = event.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = e => {
      const text = e.target.result;
      const lines = text.split(/\r?\n/);
      lines.forEach((line, idx)=>{
          if(idx===0) return; // ignorer ent√™te
          if(line.trim()==="") return;
          const [fr, el] = line.split(",");
          if(fr && el) lexique[fr.trim()] = el.trim();
      });
      sauvegarderLexique();
      alert("Lexique import√© avec succ√®s !");
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
